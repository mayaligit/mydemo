<?xml version = "1.0" encoding = "UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD com.example.Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace = "com.cmic.attendance.dao.AuditDao">
    <sql id="auditColumns">
        a.id AS "id",
        a.submit_time AS "submitTime",
        a.audit_content AS "auditContent",
        a.audit_user_id AS "auditUserId",
        a.audit_user_name AS "auditUserName",
        a.audit_status AS "auditStatus",
        a.audit_time AS "auditTime",
        a.attendance_id AS "attendanceId",
        a.audit_suggestion AS "auditSuggestion",
        a.business_type AS "businessType",
        a.create_by AS "createBy.id",
        a.create_time AS "createTime",
        a.update_by AS "updateBy.id",
        a.update_time AS "updateTime",
        a.audit_detail AS "auditDetail",
        a.username AS "username"
    </sql>

    <sql id="auditJoins">
    </sql>

    <select id="get" resultType="Audit">
        SELECT
        <include refid="auditColumns"/>
        FROM t_audit a
        <include refid="auditJoins"/>
        WHERE a.id = #{id}
    </select>

    <select id="findList" resultType="Audit">
        SELECT
        <include refid="auditColumns"/>
        FROM t_audit a
        <include refid="auditJoins"/>
        <where>
            1 = 1
        </where>
    </select>

    <select id="findAllList" resultType="Audit">
        SELECT
        <include refid="auditColumns"/>
        FROM t_audit a
        <include refid="auditJoins"/>
    </select>

    <insert id="insert">
        INSERT INTO t_audit(
            id,
            submit_time,
            audit_content,
            audit_user_id,
            audit_user_name,
            audit_status,
            audit_time,
            attendance_id,
            audit_suggestion,
            business_type,
            create_by,
            create_time,
            update_by,
            update_time,
            audit_detail,
            username,
            suggestion_remarks
        ) VALUES (
            #{id},
            #{submitTime},
            #{auditContent},
            #{auditUserId},
            #{auditUserName},
            #{auditStatus},
            #{auditTime},
            #{attendanceId},
            #{auditSuggestion},
            #{businessType},
            #{createBy.id},
            #{createTime},
            #{updateBy.id},
            #{updateTime},
            #{auditDetail},
            #{username},
            #{suggestionRemarks}
        )
    </insert>

    <update id="update">
        UPDATE t_audit SET
        submit_time = #{submitTime},
        audit_content = #{auditContent},
        audit_user_id = #{auditUserId},
        audit_user_name = #{auditUserName},
        audit_status = #{auditStatus},
        audit_time = #{auditTime},
        attendance_id = #{attendanceId},
        audit_suggestion = #{auditSuggestion},
        business_type = #{businessType},
        create_by = #{createBy.id},
        create_time = #{createTime},
        update_by = #{updateBy.id},
        update_time = #{updateTime},
        audit_detail = #{auditDetail},
        username = #{username},
        suggestion_remarks = #{suggestionRemarks}
        WHERE id = #{id}
    </update>

    <update id="dynamicUpdate">
        UPDATE t_audit SET
        <if test="submitTime != null ">
        submit_time = #{submitTime},
        </if>
        <if test="auditContent != null  and auditContent != ''">
        audit_content = #{auditContent},
        </if>
        <if test="auditUserId != null  and auditUserId != ''">
        audit_user_id = #{auditUserId},
        </if>
        <if test="auditUserName != null  and auditUserName != ''">
        audit_user_name = #{auditUserName},
        </if>
        <if test="auditStatus != null  and auditStatus != ''">
        audit_status = #{auditStatus},
        </if>
        <if test="auditTime != null ">
        audit_time = #{auditTime},
        </if>
        <if test="attendanceId != null  and attendanceId != ''">
        attendance_id = #{attendanceId},
        </if>
        <if test="auditSuggestion != null  and auditSuggestion != ''">
        audit_suggestion = #{auditSuggestion},
        </if>
        <if test="businessType != null  and businessType != ''">
        business_type = #{businessType},
        </if>
        <if test="createTime != null ">
        create_time = #{createTime},
        </if>
        <if test="updateTime != null ">
        update_time = #{updateTime},
        </if>
        <if test="auditDetail != null  and auditDetail != ''">
        audit_detail = #{auditDetail},
        </if>
        <if test="username != null  and username != ''">
        username = #{username},
        </if>
        <if test="suggestion_remarks != null  and suggestion_remarks != ''">
            suggestion_remarks = #{suggestionRemarks},
        </if>
        update_by = #{updateBy.id},
        update_date = #{updateDate}
        WHERE id = #{id}
    </update>

    <delete id="delete">
        DELETE FROM t_audit
        WHERE id = #{id}
    </delete>

    <select id="getAuditById" parameterType="String" resultType="Audit">
        SELECT
        id ,username ,submit_time AS "submitTime" ,audit_content AS "auditContent" , audit_detail AS "auditDetail",
        audit_status AS "auditStatus",audit_suggestion AS "auditSuggestion",suggestion_remarks AS "suggestionRemarks",
        create_by AS "createBy.id",business_type AS "businessType"
        FROM t_audit
        WHERE id = #{auditId}
    </select>

    <update id="updateAudit" parameterType="map">
        UPDATE t_audit SET
        <if test="auditStatus != null and auditStatus != ''">
            audit_status = #{auditStatus},
        </if>
        <if test="auditSuggestion != null and auditSuggestion != ''">
            audit_suggestion=#{auditSuggestion},
        </if>
        <if test="auditTime != null and auditTime != ''">
            audit_time=#{auditTime},
        </if>
        <if test="suggestionRemarks != null and suggestionRemarks != ''">
            suggestion_remarks=#{suggestionRemarks},
        </if>
        update_by=#{updateBy},
        update_time=#{updateTime}
        WHERE id =#{auditId}
    </update>

    <select id="findAuditList" resultType="Map" parameterType="Audit">
        SELECT
	      a.id , a.username ,a.audit_content AS auditContent ,
          date_format(a.submit_time,'%Y年%m月%d日 %T') AS submitTime ,a.audit_status AS auditStatus
        FROM t_audit a
        <where>
            1=1
            <if test="username != null and username != ''">
                and username = #{username}
            </if>
            <if test="auditStatus != null and auditStatus != ''">
                and audit_status = #{auditStatus}
            </if>
        </where>

    </select>

</mapper>